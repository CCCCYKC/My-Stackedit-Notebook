# 生命周期+监听器

## 1. 生命周期
>- 主要介绍生命周期中的 `Mounted` 和 `created`
>- `Mounted`中赋值时不能赋值变量！
### （1）Mounted
**是在组件挂载完成后，自动调用 Mounted 内的内容**
```html
<script>
export default{
	Mounted(){
		this.$refs.pElementRef.textContent = 'Mounted';
	}
}
</script>
<template>
	<p ref="pElementRef">hello</p>
</template>
```
- Mounted 中可以设置自动调用的函数
```html
<script>
export default {
  data() {
    return {
      todoId: 1,
      todoData: null
    }
  },
  methods: {
    async fetchData() {
      this.todoData = null
      const res = await fetch(
        `https://jsonplaceholder.typicode.com/todos/${this.todoId}`
      )
      this.todoData = await res.json()
    }
  },
  mounted() {
    this.fetchData()
  },
  watch:{
    todoId(){
      this.fetchData()
    }
  }
}
</script>
<template>
  <p>Todo id: {{ todoId }}</p>
  <button @click="todoId++" :disabled="!todoData">Fetch next todo</button>
  <p v-if="!todoData">Loading...</p>
  <pre v-else>{{ todoData }}</pre>
</template>
```
**代码逻辑：**
- 在组件挂载完成后，先调用一次`fetchData()`，获取到 todoData
- 点击按钮，todoId改变后，监听器监听到改变，执行`fetchData()`，获取到新的 todoData

### （2）created
>- `created` 是一个生命周期钩子函数 
>- 用于在组件实例被创建之后立即执行一些操作。它是在组件实例已经完成数据初始化，但尚未挂载到 DOM 时触发的。

**示例（与emits连用）：**
```html
//在子组件中
<script>
export default {
  // 声明触发的事件
  emits: ['response'],
  created() {
    // 在组件创建时触发事件
    this.$emit('response', 'hello from child');
  }
}
</script>
```
```html
//在父组件中
<template>
  <ChildComp @response="handleResponse" />
</template>

<script>
import ChildComp from './ChildComp.vue';
export default {
  components: {
    ChildComp
  },
  methods: {
    handleResponse(message) {
      console.log(message); // 输出 'hello from child'
    }
  }
}
</script>
```



## 2. 监听器
>- 主要介绍`watch`
>- 监听器中的回调函数可分为无参数或有参数

参数中第一个一定为新值，第二个一定为旧值
```javascript
todoId(newtodoId, oldtodoId){
	console.log('${oldtodoId} change to ${newtodoId}')
}
```
函数的参数也可以省略（当回调函数不需要新旧值时）
```html
<script>
export default {
  data() {
    return {
      todoId: 1,
      todoData: null,
      content: null
    }
  },
  methods: {
    async fetchData() {
      this.todoData = null
      const res = await fetch(
        `https://jsonplaceholder.typicode.com/todos/${this.todoId}`
      )
      this.todoData = await res.json()
    }
  },
  mounted() {
    this.fetchData()
  },
  watch:{
    todoId(newtodoId,oldtodoId){
      this.fetchData(),
      this.content= oldtodoId +'to'+ newtodoId
    }
  }
}
</script>
<template>
  <p>Todo id: {{ todoId }}</p>
  <button @click="todoId++" :disabled="!todoData">Fetch next todo</button>
  <p v-if="!todoData">Loading...</p>
  <pre v-else>{{ todoData }}</pre>
  <p>{{content}}</p>
</template>
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTM3MDUyNDU5Ml19
-->