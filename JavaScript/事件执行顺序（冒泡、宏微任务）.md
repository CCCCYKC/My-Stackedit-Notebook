# 事件执行顺序（冒泡、宏微任务）

## 一、冒泡 & 如何阻止冒泡


## 二、任务执行顺序
>- 先执行顺序
>- 然后执行微任务
>- 最后执行宏任务
```js
// 这段代码的执行顺序是什么样的?
console.log('start')
setTimeout(() =>{
console.log('timeout');},0);
Promise.resolve().then(() => { console.log('promise 1');});
Promise.resolve().then(() =>{
console.log('promise 2');
});
console.log( 'end');
//start
//end
//promise 1
//promise 2
//timeout
```

1.  **同步代码执行**：
    
    -   首先，`console.log('start')` 会立即执行，输出 `start`。
    -   然后，`setTimeout(() => { console.log('timeout'); }, 0);` 被调用，将回调函数放入宏任务队列中，等待至少 0 毫秒后执行。
    -   接下来，`Promise.resolve().then(() => { console.log('promise 1'); });` 被调用，将回调函数放入微任务队列中。
    -   紧接着，`Promise.resolve().then(() => { console.log('promise 2'); });` 也被调用，将回调函数放入微任务队列中。
    -   最后，`console.log('end')` 会立即执行，输出 `end`。
2.  **微任务执行**：
    -   在同步代码执行完毕后，JavaScript 引擎会检查微任务队列。此时，微任务队列中有两个任务：
        -   `console.log('promise 1')`
        -   `console.log('promise 2')`
    -   这两个微任务会依次执行，输出 `promise 1` 和 `promise 2`。
3.  **宏任务执行**：
    -   完成所有微任务后，事件循环会进入下一个阶段，检查宏任务队列。此时，宏任务队列中有 `setTimeout` 的回调函数：
        -   `console.log('timeout')`
    -   这个回调函数会被执行，输出 `timeout`。

## 三、微任务宏任务的区别
在 JavaScript 的事件循环机制中，任务被分为两类：**微任务（Microtasks）** 和 **宏任务（Macrotasks）**。它们的主要区别在于执行时机和优先级。

### **1. 微任务（Microtasks）**

微任务是一种在当前执行栈中的代码执行完毕后，立即执行的任务。它们通常用于处理一些**需要尽快执行的异步操作**，例如 `Promise` 的回调函数。

#### **常见的微任务来源：**
-   **`Promise` 的 `.then()` 和 `.catch()` 回调**：当一个 `Promise` 状态变为 `resolved` 或 `rejected` 时，注册的回调函数会被放入微任务队列。
-   **`MutationObserver`**：用于监听 DOM 的变化，其回调函数也会被放入微任务队列。
-   **`queueMicrotask()`**：这是一个专门用于将任务放入微任务队列的函数。

#### **执行时机**
-   微任务会在当前执行栈中的同步代码执行完毕后，立即执行。也就是说，在每次事件循环的迭代中，微任务队列会被清空，直到微任务队列为空为止。
    
### **2. 宏任务（Macrotasks）**
宏任务是一种在当前事件循环迭代完成后，进入下一个事件循环迭代时才会执行的任务。它们通常用于处理一些需要等待一定时间的异步操作，例如 `setTimeout`、`setInterval` 和 `setImmediate`。

#### **常见的宏任务来源**
-   **`setTimeout` 和 `setInterval`**：用于设置延迟执行的任务。
-   **`setImmediate`**：在 Node.js 中用于在当前事件循环迭代完成后立即执行任务。
-   **`requestAnimationFrame`**：用于在浏览器重绘之前执行任务。
-   **I/O 操作**：例如文件读写、网络请求等。
-   **事件监听器**：例如点击事件、键盘事件等。
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE5NDM3NjIyNiwxOTc4NTUwMjk3XX0=
-->